COPY START 1000
FIRST STL RETADR
    CLEAR X
    LDA #3         ; Immediate addressing with constant
    +LDB #LENGTH    ; Immediate addressing with symbol (Format 4)
    BASE LENGTH     ; Set base register
    +JSUB RDREC      ; Format 4, extended call
    LDA @BUFFER    ; Indirect addressing
    LDX LENGTH,X   ; Indexed addressing
    COMP ZERO       ; PC-relative (if in range)
    JEQ ENDFIL
    +LDA @BUFFER   ; Format 4 with indirect operand (needs M record)
    TIXR X          ; Format 2
    +LDA #2000       ; Format 4 with immediate constant (noM record)
    RSUB               ; Format 3
    TIO                ; Format 1
WLOOP TD OUTPUT
    STA BUFFER
    HIO                ; Format 1
    SIO                ; Format 1
OUTPUT BYTE X'05'
RETADR RESW    1
LENGTH WORD    3
ZERO   WORD    0
BUFFER RESB    4096
EOF BYTE    C'EOF'
RDREC RSUB
    END START